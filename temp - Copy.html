<!DOCTYPE html>
<html>
<head>
	<title>Austin's Gender Dungeon</title>
	<script src="jQuery.txt"></script>
	<meta charset="utf-8"/>
	<link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
	<div id = gameWin>
		
		
		<div id = "northDoor" class = "door">N</div>
		<div id = "eastDoor" class = "door">E</div>
		<div id = "southDoor" class = "door">S</div>
		<div id = "westDoor" class = "door">W</div>

		<!--<div class = "guy">:/</div>-->
		<div id = "guy"><canvas id="face" width="50" height="50"></canvas></div>
		<!--<div id = "guy"><img id = "selfie" src = "Sinclair's Face.jpg"></div>-->
	</div>
<script>
//centering game window
var winW = window.innerWidth;
var winH = window.innerHeight;
var gWin = $("#gameWin");
gWin.offset({left: (winW - gWin.width())/2, top: (winH - gWin.height())/2});

var winTop = gWin.offset().top;
var winLeft = gWin.offset().left;

//player
var thePlayer = {name: "Jessie", hitpoints:10, attack:10, speed:10};
var drawOnThis = document.getElementById("face");
var drawOnThisTwo = drawOnThis.getContext("2d");
drawOnThisTwo.fillStyle = "#FF0000";
drawOnThisTwo.fillRect(0,0,100,100);
//drawOnThisTwo.drawImage(document.getElementById("selfie"), 10, 10);

//world
var maxX = 5;
var maxY = 4;

var world = new Array(maxX);
for (i = 0; i < maxX; i++)
{
	world[i] = new Array(maxY);
}

console.log(world);

//start room
var roomX = Math.floor(maxX/2);
var roomY = Math.floor(maxY/2);

world[roomX][roomY] = {north:true, east:true, south:true, west:true};
drawDoors();
//generates a room by looking at the spot, then checking around the spot to make sure it is consistant.
function generateRoom(x, y)
{
	if (world[x][y] != null)
	{
		//don't need to generate room
		console.log("The room at " + x + ", " + y + "already exists");
		return false;
	}
	var newRoom = {north:false, east:false, south:false, west:false};

	//north
	if (y > 0) //if room above exists
	{
		if (world[x][y-1] != null)
		{
			newRoom.north = world[x][y-1].south;
		}
		else newRoom.north = randDoor();
	}

	//east
	if (x < maxX - 1) //if room right exists
	{
		if (world[x+1][y] != null)
		{
			newRoom.east = world[x+1][y].west;
		}
		else newRoom.east = randDoor();
	}

	//south
	if (y < maxY - 1) //if room below exists
	{
		if (world[x][y+1] != null)
		{
			newRoom.south = world[x][y+1].north;
		}
		else newRoom.south = randDoor();
	}

	//west
	if (x > 0) //if room left exists
	{
		if (world[x-1][y] != null)
		{
			newRoom.west = world[x-1][y].east;
		}
		else newRoom.west = randDoor();
	}

	console.log("New room generated at " + x + ", " + y);
	world[x][y] = newRoom;
	return true;
}
//40% of time returns true
function randDoor()
{
	//console.log("randDoor()");
	return Math.random() < 0.40;
}

//Movement stuff
var playerX = gWin.width()/2;
var playerY = gWin.height()/2;

var moveRight = false;
var moveLeft = false;
var moveUp = false;
var moveDown = false;

$("body").keydown(onDown);
$("body").keyup(onUp);
//when button are pressed, change the movement to true
// Simple comment
function onDown(event)
{
	//console.log("down: " + event.keyCode);
	switch(event.keyCode)
	{
		case 87: //w
			moveUp = true;
			break;
		case 65: //a
			moveLeft = true;
			break;
		case 83: //s
			moveDown = true;
			break;
		case 68: //d
			moveRight = true;
			break;
	}

}
//undo the button
function onUp(event)
{
	//console.log("up: " + event.keyCode);
	switch(event.keyCode)
	{
		case 87: //w
			moveUp = false;
			break;
		case 65: //a
			moveLeft = false;
			break;
		case 83: //s
			moveDown = false;
			break;
		case 68: //d
			moveRight = false;
			break;
	}
}

//moves players x/y
function move()
{
	//TODO: fix diagonal fast moving bug
	
	var dx = 1.5; var dy = 1.5;
	if (moveUp)
	{
		playerY -= dy;
	}
	if (moveRight)
	{
		playerX += dx;
	}
	if (moveDown)
	{
		playerY += dy;
	}
	if (moveLeft)
	{
		playerX -= dx;
	}


	//y wrap around
	var thisRoom = world[roomX][roomY];
	if (playerY < 0) //top wall
	{
		if ( thisRoom.north && inDoorHoriz( $("#northDoor")) )
		{
			playerY = gWin.height() - $("#guy").height();
			roomY--;
			drawDoors();
		}
		else playerY += dy;
	}
	else if ( playerY + $("#guy").height() > gWin.height() ) //bottom wall
	{
		if ( thisRoom.south && inDoorHoriz($("#southDoor")) )
		{
			playerY = 0;
			roomY++;
			drawDoors();
		}
		else playerY -= dy;
	}

	//x wrap around
	if ( playerX + $("#guy").width() > gWin.width() ) //right wall
	{
		if ( thisRoom.east && inDoorVert($("#eastDoor")) )
		{
			playerX = 0;
			roomX++;
			drawDoors();
		}
		else playerX -= dx;
	}
	else if (playerX < 0) //left wall
	{
		if ( thisRoom.west && inDoorVert($("#westDoor")) )
		{
			playerX = gWin.width() - $("#guy").width();
			roomX--;
			drawDoors();
		}
		else playerX += dx;
	}
}

//check whether guy is inside a door
function inDoorVert($door) //vertical door
{
	var doorTop = $door.offset().top;
	var dBot = doorTop + $door.height();
	var guyTop = playerY + winTop;
	var guyBot = guyTop + $("#guy").height();

	return guyTop > doorTop && guyBot < dBot;
}

function inDoorHoriz($door) //horizontal door
{
	var dLeft = $door.offset().left;

	var guyLeft = playerX + winLeft;

	return guyLeft > dLeft && //left
	guyLeft + $("#guy").width() < dLeft + $door.width(); //right
}

function drawDoors()
{
	console.log("drawDoors() for " + roomX + ", " + roomY);

	generateRoom(roomX, roomY);
	var thisRoom = world[roomX][roomY];
	console.log("This room is " + thisRoom.north + ", " + thisRoom.east + ", " + thisRoom.south + ", " + thisRoom.west);

	$("#northDoor").toggle(thisRoom.north);
	$("#eastDoor").toggle(thisRoom.east);
	$("#southDoor").toggle(thisRoom.south);
	$("#westDoor").toggle(thisRoom.west);

	//positioning doors
	$("#northDoor").offset({left: (winW - $(".door").width())/2, top: winTop });
	$("#eastDoor").offset({left: winW - winLeft - $(".door").width(), top: (winH - $(".door").height())/2});
	$("#southDoor").offset({left: (winW - $(".door").width())/2, top: winH - winTop - $(".door").height()});
	$("#westDoor").offset({left: winLeft, top: (winH - $(".door").height())/2});
}

function updateImage()
{
	$("#guy").offset({top: playerY + winTop, left: playerX + winLeft});
}
setInterval(move, 1);
setInterval(updateImage, 1);

</script>
</body>
</html>
